!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=2)}([function(e,n){e.exports=require("passport")},function(e,n){e.exports=require("bcryptjs")},function(e,n,t){const o=t(3),r=t(4),i=t(5)(r),s=t(0),u=o();t(6),u.use(o.json()),u.use(o.urlencoded({extended:!1})),u.use(o.static("public")),u.use(r({secret:"obobNMN23h",store:new i,cookie:{path:"/",httpOnly:!0,maxAge:36e5},resave:!1,saveUninitialized:!1})),u.use(s.initialize()),u.use(s.session());let l=!1;u.post("/login",async(e,n,t)=>{await s.authenticate("local",(o,r)=>o?t(o):r?void e.logIn(r,(function(o){if(o)return t(o);return console.log(e.session),console.log(e.isAuthenticated()),l=e.isAuthenticated(),setTimeout((function(){l=!1}),36e5),n.send("Admin page")})):n.send("Send correct email or password"))(e,n,t)});u.get("/",(e,n)=>n.send("Main page")),u.get("/admin",(e,n,t)=>{if(!l)return console.log(e.isAuthenticated()),n.redirect("/");t()},(e,n)=>{n.send("Admin page")}),u.get("/logout",(e,n)=>{console.log("logout",e.session),e.logout(),l=!1,n.redirect("/")}),u.listen(8e3,()=>console.log("Server is listening on 8000"))},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("express-session")},function(e,n){e.exports=require("session-file-store")},function(e,n,t){const o=t(0),r=t(7).Strategy,i=t(1),s=t(8);o.serializeUser((e,n)=>{console.log("Сериализация"),n(null,e._id)}),o.deserializeUser((e,n)=>{console.log("Десериализация "+e);n(null,s.usersDB._id===e&&s)}),o.deserializeUser(async(e,n)=>{try{console.log("Десериализация "+_id);if(!await s.usersDB.findOne({email:e}))return n(new Error("user not found"))}catch(e){n(e)}}),o.use(new r({usernameField:"email"},(async function(e,n,t){let o={};try{if(await s.usersDB.findOne({email:e}).then((function(e){o=i.compareSync(n,e.password)?e:""})),console.log(o),!o)return t(null,!1)}catch(e){return t(e)}return t(null,o)})))},function(e,n){e.exports=require("passport-local")},function(e,n,t){const o=t(9).create("./db.db");t(1);e.exports.usersDB=o},function(e,n){e.exports=require("nedb-promises")}]);